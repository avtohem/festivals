ALTER DATABASE festival CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;

-- a small number of track rows are causing problem, just get rid of them
delete from track where name like '%â€¦%';
delete from track where length(url) > 191;

ALTER TABLE audit_log MODIFY actor VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY address_line1 VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY address_line2 VARCHAR(191) NULL;
ALTER TABLE answer  MODIFY answer VARCHAR(191) NOT NULL;
ALTER TABLE user  MODIFY api_key VARCHAR(191) NULL;
ALTER TABLE blog_entry  MODIFY author VARCHAR(191) NOT NULL;
ALTER TABLE role  MODIFY authority VARCHAR(191) NOT NULL;
ALTER TABLE festival  MODIFY city VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY class_name VARCHAR(191) NULL;
ALTER TABLE competition  MODIFY code VARCHAR(191) NOT NULL;
ALTER TABLE static_content  MODIFY code VARCHAR(191) NOT NULL;
ALTER TABLE festival  MODIFY country_name VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY event_name VARCHAR(191) NULL;
ALTER TABLE artist  MODIFY image VARCHAR(191) NULL;
ALTER TABLE album  MODIFY large_image_url VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY lineup_url VARCHAR(191) NULL;
ALTER TABLE artist  MODIFY mbid VARCHAR(191) NULL;
ALTER TABLE album  MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE artist  MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE festival MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE tags  MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE track  MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE user  MODIFY name VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY new_value VARCHAR(191) NULL;
ALTER TABLE audit_log  MODIFY old_value VARCHAR(191) NULL;
ALTER TABLE user  MODIFY password VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY persisted_object_id VARCHAR(191) NULL;
ALTER TABLE user  MODIFY photo VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY post_code VARCHAR(191) NULL;
ALTER TABLE comment  MODIFY poster_class VARCHAR(191) NOT NULL;
ALTER TABLE user  MODIFY preferred_username VARCHAR(191) NULL;
ALTER TABLE performance  MODIFY priority VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY property_name VARCHAR(191) NULL;
ALTER TABLE competition  MODIFY question VARCHAR(191) NOT NULL;
ALTER TABLE mail_log  MODIFY recipient VARCHAR(191) NOT NULL;
ALTER TABLE festival  MODIFY region VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY skiddle_url VARCHAR(191) NULL;
ALTER TABLE user  MODIFY social_login_provider VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY source VARCHAR(191) NOT NULL;
ALTER TABLE import_audit  MODIFY source VARCHAR(191) NOT NULL;
ALTER TABLE mail_log  MODIFY subject VARCHAR(191) NULL;
ALTER TABLE artist  MODIFY thumbnail VARCHAR(191) NULL;
ALTER TABLE blog_entry  MODIFY title VARCHAR(191) NOT NULL;
ALTER TABLE competition  MODIFY title VARCHAR(191) NOT NULL;
ALTER TABLE review   MODIFY title VARCHAR(191) NOT NULL;
ALTER TABLE confirmation_code  MODIFY token VARCHAR(191) NOT NULL;
ALTER TABLE festival  MODIFY twitter_username VARCHAR(191) NULL;
ALTER TABLE comment_link  MODIFY type VARCHAR(191) NOT NULL;
ALTER TABLE confirmation_code  MODIFY type VARCHAR(191) NOT NULL;
ALTER TABLE festival MODIFY type VARCHAR(191) NULL;
ALTER TABLE rating  MODIFY type VARCHAR(191) NOT NULL;
ALTER TABLE tag_links  MODIFY type VARCHAR(191) NOT NULL;
ALTER TABLE audit_log  MODIFY uri VARCHAR(191) NULL;
ALTER TABLE album  MODIFY url VARCHAR(191) NULL;
ALTER TABLE track  MODIFY url VARCHAR(191) NULL;
ALTER TABLE confirmation_code  MODIFY username VARCHAR(191) NOT NULL;
ALTER TABLE user  MODIFY username VARCHAR(191) NOT NULL;
ALTER TABLE festival  MODIFY video_url VARCHAR(191) NULL;
ALTER TABLE festival  MODIFY website VARCHAR(191) NULL;

ALTER TABLE user CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE artist CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE competition CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE comment CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE role CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE tags CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE festival CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE answer CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE album CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE comment_link CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE tag_links CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE track CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE artist_subscription CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE favorite_festival CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE festival_subscription CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE performance CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE rating CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE reminder CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE review CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE user_role CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE entry CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE audit_log CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE blog_entry CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE confirmation_code CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE import_audit CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE mail_log CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE static_content CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;